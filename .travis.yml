language: c++
cache: ccache
dist: xenial
matrix:
  - compiler:
    - clang
    - gcc
env:
  MAKEFLAGS="-j2"
install:
  - sudo apt-get update
  - sudo apt-get install libgmp-dev libmpfr-dev libflint-dev valgrind
  # install Arb development version
  - wget https://github.com/fredrik-johansson/arb/archive/2.16.0.tar.gz
  - tar xf 2.16.0.tar.gz
  - cd arb-2.16.0
  - ./configure --prefix=/usr && make && sudo make install
  - cd ..
  # build E-ANTIC
  - ./bootstrap.sh
  - ./configure --prefix=/usr --enable-valgrind
  - cat config.log
  - make
  - ldd .libs/libeantic.so

script:
  - make check || (cat `find test-suite.log`; false)
  - make check-valgrind || (cat `find test-suite-memcheck.log`; false)
  - make distcheck
