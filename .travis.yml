language: generic
env:
  - CC=gcc CXX=g++ PACKAGES=g++
  - CC=clang CXX=clang++ PACKAGES=clang
services:
  - docker
script:
  - |
    docker run -i -e CC -e CXX -e PACKAGES -v ${TRAVIS_BUILD_DIR}:/eantic -w /eantic ubuntu:cosmic <<-"EOF"
      set -exo pipefail
      export MAKEFLAGS="-j2"
      apt-get update
      apt-get -y install libgmp-dev libmpfr-dev libflint-dev valgrind libflint-arb-dev libboost-all-dev libtool make autoconf $PACKAGES
      ./bootstrap.sh
      ./configure --prefix=/usr --enable-valgrind || (cat config.log; false)
      make
      ldd .libs/libeantic.so
      make check || (cat `find test-suite.log`; false)
      make check-valgrind || (cat `find test-suite-memcheck.log`; false)
      make distcheck
    EOF
